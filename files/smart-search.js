function SearchFieldInit(r){if(r.f_search=r.find(".search-form"),0==r.f_search.length)return!1;if(r.s_search=r.f_search.find(".search-input"),r.s_reset=r.f_search.find(".search-reset"),"function"!=typeof r.SearchFieldCheck)return console.log("function SearchFieldCheck is not found in object for SearchFieldInit",{status:"error"}),!1;if(1<r.f_search.length)return console.log("function SearchFieldInit must have only one search object",{status:"error"}),!1;var c;r.__SearchFieldCheck=function(e){if(r.s_search.val().length?r.f_search.addClass("search__filled"):r.f_search.removeClass("search__filled"),void 0!==e&&e)return r.SearchFieldCheck();setTimeout(function(){r.__SearchFieldCheck(1)},20)},r.s_search.click(function(){r.__SearchFieldCheck()}).focus(function(){r.f_search.addClass("search__focused"),r.__SearchFieldCheck()}).blur(function(){r.f_search.removeClass("search__focused"),r.__SearchFieldCheck()}).keyup(function(e){switch(e.keyCode){case 13:case 27:case 38:case 40:break;default:r.f_search.removeClass("search__focused"),r.__SearchFieldCheck()}}).bind("paste",function(e){r.__SearchFieldCheck(),setTimeout(function(){r.__SearchFieldCheck()},20)}).bind("cut",function(e){$("#search-result").hide(),$("#search-result .inner .result-item").remove(),r.__SearchFieldCheck()});var o=0;r.s_search.keydown(function(e){switch(e.keyCode){case 27:return $("#search-result").hide(),!1;case 13:if(o){var r=$("#search-result .result-item").eq(o-1).find("a"),a=r.attr("href");return a?document.location=a:r.trigger("click"),!1}break;case 38:case 40:e.preventDefault(),(c=$("#search-result .result-item").length)&&(s=e.keyCode-39,(t=$("#search-result .result-item a")).eq(o-1).removeClass("_active"),1==s&&o<c?o++:-1==s&&0<o&&o--,0<o&&t.eq(o-1).addClass("_active"));break;default:o=0}var s,t}),r.s_reset.click(function(){r.s_search.val("").focus(),$("#search-result").hide(),$("#search-result .inner .result-item").remove()}),r.__SearchFieldCheck()}function htmlspecialchars(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function substr(e,r,a){var s=(e+="").length;return r<0&&(r+=s),s=void 0===a?s:a<0?a+s:a+r,!(r>=e.length||r<0||s<r)&&e.slice(r,s)}function md5(e){function i(e,r){return e<<r|e>>>32-r}function l(e,r){var a=2147483648&e,s=2147483648&r,t=1073741824&e,c=1073741824&r,o=(1073741823&e)+(1073741823&r);return t&c?2147483648^o^a^s:t|c?1073741824&o?3221225472^o^a^s:1073741824^o^a^s:o^a^s}function r(e,r,a,s,t,c,o){var n;return e=l(e,l(l((n=r)&a|~n&s,t),o)),l(i(e,c),r)}function a(e,r,a,s,t,c,o){var n;return e=l(e,l(l(r&(n=s)|a&~n,t),o)),l(i(e,c),r)}function s(e,r,a,s,t,c,o){return e=l(e,l(l(r^a^s,t),o)),l(i(e,c),r)}function t(e,r,a,s,t,c,o){return e=l(e,l(l(a^(r|~s),t),o)),l(i(e,c),r)}function c(e){for(var r="",a="",s=0;s<=3;s++)r+=(a="0"+(e>>>8*s&255).toString(16)).substr(a.length-2,2);return r}for(var o,n,h,u,d,g=1732584193,f=4023233417,_=2562383102,m=271733878,v=(o=function(e){for(var r,a=e.length,s=a+8,t=16*(1+(s-s%64)/64),c=new Array(t-1),o=0,n=0;n<a;)o=n%4*8,c[r=(n-n%4)/4]=c[r]|e.charCodeAt(n)<<o,n++;return o=n%4*8,c[r=(n-n%4)/4]=c[r]|128<<o,c[t-2]=a<<3,c[t-1]=a>>>29,c}(e=this.utf8_encode(e))).length,C=0;C<v;C+=16)f=t(f=t(f=t(f=t(f=s(f=s(f=s(f=s(f=a(f=a(f=a(f=a(f=r(f=r(f=r(f=r(h=f,_=r(u=_,m=r(d=m,g=r(n=g,f,_,m,o[C+0],7,3614090360),f,_,o[C+1],12,3905402710),g,f,o[C+2],17,606105819),m,g,o[C+3],22,3250441966),_=r(_,m=r(m,g=r(g,f,_,m,o[C+4],7,4118548399),f,_,o[C+5],12,1200080426),g,f,o[C+6],17,2821735955),m,g,o[C+7],22,4249261313),_=r(_,m=r(m,g=r(g,f,_,m,o[C+8],7,1770035416),f,_,o[C+9],12,2336552879),g,f,o[C+10],17,4294925233),m,g,o[C+11],22,2304563134),_=r(_,m=r(m,g=r(g,f,_,m,o[C+12],7,1804603682),f,_,o[C+13],12,4254626195),g,f,o[C+14],17,2792965006),m,g,o[C+15],22,1236535329),_=a(_,m=a(m,g=a(g,f,_,m,o[C+1],5,4129170786),f,_,o[C+6],9,3225465664),g,f,o[C+11],14,643717713),m,g,o[C+0],20,3921069994),_=a(_,m=a(m,g=a(g,f,_,m,o[C+5],5,3593408605),f,_,o[C+10],9,38016083),g,f,o[C+15],14,3634488961),m,g,o[C+4],20,3889429448),_=a(_,m=a(m,g=a(g,f,_,m,o[C+9],5,568446438),f,_,o[C+14],9,3275163606),g,f,o[C+3],14,4107603335),m,g,o[C+8],20,1163531501),_=a(_,m=a(m,g=a(g,f,_,m,o[C+13],5,2850285829),f,_,o[C+2],9,4243563512),g,f,o[C+7],14,1735328473),m,g,o[C+12],20,2368359562),_=s(_,m=s(m,g=s(g,f,_,m,o[C+5],4,4294588738),f,_,o[C+8],11,2272392833),g,f,o[C+11],16,1839030562),m,g,o[C+14],23,4259657740),_=s(_,m=s(m,g=s(g,f,_,m,o[C+1],4,2763975236),f,_,o[C+4],11,1272893353),g,f,o[C+7],16,4139469664),m,g,o[C+10],23,3200236656),_=s(_,m=s(m,g=s(g,f,_,m,o[C+13],4,681279174),f,_,o[C+0],11,3936430074),g,f,o[C+3],16,3572445317),m,g,o[C+6],23,76029189),_=s(_,m=s(m,g=s(g,f,_,m,o[C+9],4,3654602809),f,_,o[C+12],11,3873151461),g,f,o[C+15],16,530742520),m,g,o[C+2],23,3299628645),_=t(_,m=t(m,g=t(g,f,_,m,o[C+0],6,4096336452),f,_,o[C+7],10,1126891415),g,f,o[C+14],15,2878612391),m,g,o[C+5],21,4237533241),_=t(_,m=t(m,g=t(g,f,_,m,o[C+12],6,1700485571),f,_,o[C+3],10,2399980690),g,f,o[C+10],15,4293915773),m,g,o[C+1],21,2240044497),_=t(_,m=t(m,g=t(g,f,_,m,o[C+8],6,1873313359),f,_,o[C+15],10,4264355552),g,f,o[C+6],15,2734768916),m,g,o[C+13],21,1309151649),_=t(_,m=t(m,g=t(g,f,_,m,o[C+4],6,4149444226),f,_,o[C+11],10,3174756917),g,f,o[C+2],15,718787259),m,g,o[C+9],21,3951481745),g=l(g,n),f=l(f,h),_=l(_,u),m=l(m,d);return(c(g)+c(f)+c(_)+c(m)).toLowerCase()}function utf8_encode(e){for(var r,a=e+"",s="",t=r=0,c=a.length,o=0;o<c;o++){var n=a.charCodeAt(o),i=null;n<128?r++:i=127<n&&n<2048?String.fromCharCode(n>>6|192)+String.fromCharCode(63&n|128):String.fromCharCode(n>>12|224)+String.fromCharCode(n>>6&63|128)+String.fromCharCode(63&n|128),null!==i&&(t<r&&(s+=a.substring(t,r)),s+=i,t=r=o+1)}return t<r&&(s+=a.substring(t,a.length)),s}function rand(e,r){var a=arguments.length;if(0===a)e=0,r=2147483647;else if(1===a)throw new Error("Warning: rand() expects exactly 2 parameters, 1 given");return Math.floor(Math.random()*(r-e+1))+e}function GenMd5Hash(){return substr(md5(parseInt((new Date).getTime()/1e3,10)),rand(0,24),8)}$(function(){var o=$(".search"),n={target:"form.store_ajax_catalog",url:"/admin/store_catalog",items_target:"#goods",last_search_query:""},e=GenMd5Hash();void 0===document.SearchInCatalogAjaxQuerySender&&(document.SearchInCatalogAjaxQuerySender={}),o.SearchFieldCheck=function(){void 0!==document.lastTimeoutId&&clearTimeout(document.lastTimeoutId),document.lastTimeoutId=setTimeout("document.SearchInCatalogAjaxQuerySender['"+e+"']('"+htmlspecialchars(o.s_search.val())+"');",300)},document.SearchInCatalogAjaxQuerySender[e]=function(r){var e,a,s=[];if("undefined"!=typeof sessionStorage)try{if(sessionStorage.getItem("lastSearchQueryArray")){s=JSON.parse(sessionStorage.getItem("lastSearchQueryArray"));var t=$.grep(s,function(e){return e.search_query==r})[0];if(t)return void c(JSON.parse(t.content))}else sessionStorage.setItem("lastSearchQueryArray","[]")}catch(e){}function c(e){if(null!=e.category.length&&0<e.category.length)for($(".result-category .result-item").remove(),$("#search-result").removeClass("_active").hide(),с=0;с<e.category.length;с++)null==e.category[с].image_icon?e.category[с].image_icon="/design/no-photo-icon.png":e.category[с].image_icon,$("#search-result").addClass("_active").show(),$("#search-result .inner .result-category").append('<div class="result-item" data-id="'+e.category[с].goods_cat_id+'"><a href="'+e.category[с].url+'"><img src="'+e.category[с].image_icon+'" class="goods-image-icon" /><span>'+e.category[с].goods_cat_name+"</span></a></div>");else $(".result-category .result-item").remove(),$("#search-result").removeClass("_active").hide();if(null!=e.goods.length&&0<e.goods.length)for($(".result-goods .result-item").remove(),$("#search-result").removeClass("_active").hide(),i=0;i<e.goods.length;i++){var r,a;null==e.goods[i].image_icon?e.goods[i].image_icon="/design/no-photo-icon.png":e.goods[i].image_icon,$("#search-result").addClass("_active").show(),i<=4&&$("#search-result .inner .result-goods").append('<div class="result-item" data-id="'+e.goods[i].goods_id+'"><a href="'+e.goods[i].url+'"><img src="'+e.goods[i].image_icon+'" class="goods-image-icon" /><span>'+e.goods[i].goods_name+"</span></a></div>"),i==e.goods.length-1&&($("#search-result .inner #show-wrap").remove(),r=$("<a>").text("Все результаты").addClass("show-all button").click(function(){$(".search-form").submit()}),a=$("<div>").attr("id","show-wrap").addClass("result-item").append(r),$("#search-result .inner .result-goods").append(a))}else $(".result-goods .result-item").remove(),$("#search-result").removeClass("_active").hide();0<e.category.length+e.goods.length?$("#search-result").addClass("_active").show():$("#search-result").removeClass("_active").hide(),0<e.category.length?$(".result-category").show().addClass("_visible"):$(".result-category").hide().removeClass("_visible"),0<e.goods.length?$(".result-goods").show():$(".result-goods").hide()}htmlspecialchars(o.s_search.val())==r&&1<o.s_search.val().length?(n.last_search_query=r,o.f_search.addClass("search__loading"),e={ajax_q:1,goods_search_field_id:0,q:n.last_search_query},a=o.s_search,$.ajax({type:"POST",cache:!1,url:o.f_search.attr("action"),data:e,dataType:"json",beforeSend:function(){o.find(".search-submit .header-searchIcon").html('<i class="fal fa-circle-notch fa-spin"></i>')},success:function(e){if(a.val()!=r)return!1;if("undefined"!=typeof sessionStorage)try{sessionStorage.setItem("lastSearchQueryArray",JSON.stringify(s)),void 0===$.grep(s,function(e){return e.search_query==r})[0]&&(s.push({search_query:r,content:JSON.stringify(e)}),sessionStorage.setItem("lastSearchQueryArray",JSON.stringify(s)))}catch(e){}c(e),o.f_search.removeClass("search__loading"),o.find(".search-submit .header-searchIcon").html('<i class="fal fa-search"></i>'),console.log("andAJAX")}})):$("#search-result").removeClass("_active").hide()},SearchFieldInit(o)});